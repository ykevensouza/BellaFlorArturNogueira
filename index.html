<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>BellaFlor Artur Nogueira | Floricultura Online</title>
  <meta name="description" content="BellaFlor Artur Nogueira - Arranjos, buquês e cestas. Encomende pelo WhatsApp." />

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;700&family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

  <style>
    :root{
      --primary:#E91E63;
      --primary-dark:#C2185B;
      --accent:#25D366; /* whatsapp */
      --bg:#F6F7F9;
      --card:#ffffff;
      --muted:#6b7280;
      --radius:14px;
      --glass: rgba(255,255,255,0.7);
      --shadow-sm: 0 6px 18px rgba(16,24,40,0.06);
      --shadow-md: 0 20px 40px rgba(16,24,40,0.08);
      --transition: 240ms cubic-bezier(.2,.9,.3,1);
      --max-width:1200px;
      --success:#10B981;
      --danger:#EF4444;
    }

    *{box-sizing:border-box}
    html,body{height:100%}
    body{font-family:'Poppins',sans-serif;background:linear-gradient(180deg,var(--bg),#fff);color:#111;margin:0;line-height:1.45;-webkit-font-smoothing:antialiased}
    a{color:inherit}

    /* Header */
    header{position:sticky;top:0;z-index:1200;background:rgba(255,255,255,0.9);backdrop-filter:saturate(120%) blur(6px);box-shadow:var(--shadow-sm)}
    .nav{max-width:var(--max-width);margin:0 auto;display:flex;align-items:center;justify-content:space-between;padding:12px 20px;gap:12px}
    .brand{display:flex;align-items:center;gap:12px;font-weight:700}
    .brand i{font-size:28px;color:var(--primary-dark)}
    .brand span{font-family:'Playfair Display',serif;font-size:1.15rem;color:var(--primary-dark);line-height:1}
    .brand small{display:block;font-size:11px;font-weight:600;color:var(--muted)}

    .nav-actions{display:flex;gap:12px;align-items:center}
    .btn-whatsapp{display:inline-flex;align-items:center;gap:10px;background:var(--accent);color:#fff;padding:10px 16px;border-radius:999px;font-weight:600;box-shadow:0 6px 18px rgba(37,211,102,0.16);border:none;text-decoration:none}
    .btn-whatsapp i{font-size:16px}

    /* Hero */
    .hero{max-width:var(--max-width);margin:18px auto;padding:28px 20px;display:grid;grid-template-columns:1fr 380px;gap:24px;align-items:center}
    @media (max-width:980px){.hero{grid-template-columns:1fr;padding:20px}} 
    @media (max-width:720px){.hero{grid-template-columns:1fr 1fr}} 

    .hero-card{background:linear-gradient(180deg,rgba(255,255,255,0.76),rgba(255,255,255,0.5));padding:28px;border-radius:var(--radius);box-shadow:var(--shadow-md);}
    .hero-title{font-family:'Playfair Display',serif;font-size:2rem;color:var(--primary-dark);margin-bottom:8px}
    .hero-sub{color:var(--muted);margin-bottom:18px}

    /* Search + filters */
    .controls{display:flex;gap:12px;align-items:center}
    .search{flex:1;display:flex;gap:8px;align-items:center;background:var(--card);padding:8px;border-radius:12px;border:1px solid rgba(0,0,0,0.04)}
    .search input{border:0;outline:0;padding:8px;font-size:14px;width:100%;background:transparent}
    .chip{background:transparent;border:1px solid rgba(0,0,0,0.06);padding:8px 12px;border-radius:999px;font-weight:600;cursor:pointer}
    .chip.active{background:linear-gradient(90deg,var(--primary),var(--primary-dark));color:#fff;border-color:transparent}

    /* Features */
    .features{display:flex;gap:12px;margin:18px 0}
    .feature{background:var(--card);padding:14px;border-radius:12px;flex:1;display:flex;gap:12px;align-items:center;box-shadow:var(--shadow-sm)}
    .feature i{font-size:20px;color:var(--primary)}

    /* Products grid */
    .products-wrap{max-width:var(--max-width);margin:10px auto;padding:0 20px}
    .controls-row{display:flex;justify-content:space-between;align-items:center;margin:6px 0}
    .grid{display:grid;grid-template-columns:repeat(1,1fr);gap:18px}
    @media(min-width:640px){.grid{grid-template-columns:repeat(2,1fr)}}
    @media(min-width:980px){.grid{grid-template-columns:repeat(3,1fr)}}
    @media(min-width:1220px){.grid{grid-template-columns:repeat(4,1fr)}}

    .card{background:var(--card);border-radius:12px;overflow:hidden;display:flex;flex-direction:column;box-shadow:var(--shadow-sm);transition:transform var(--transition),box-shadow var(--transition)}
    .card:hover{transform:translateY(-8px);box-shadow:var(--shadow-md)}
    .media{height:220px;background:#eee;position:relative}
    .media img{width:100%;height:100%;object-fit:cover;display:block}
    .card-body{padding:14px;display:flex;flex-direction:column;gap:8px}
    .category{font-size:12px;color:var(--primary);font-weight:700;text-transform:uppercase}
    .title{font-size:1rem;font-weight:700}
    .desc{font-size:13px;color:var(--muted);flex:1}
    .meta{display:flex;justify-content:space-between;align-items:center;gap:8px}
    .price{font-weight:800;color:var(--primary-dark)}
    .price small{font-weight:600;color:var(--muted);font-size:12px}
    .actions{display:flex;gap:8px}
    .btn-small{padding:8px 10px;border-radius:10px;border:0;cursor:pointer;font-weight:700}
    .btn-outline{background:transparent;border:1px solid rgba(0,0,0,0.06)}
    .btn-primary{background:linear-gradient(135deg,var(--primary),var(--primary-dark));color:#fff}

    .badge{position:absolute;left:12px;top:12px;background:rgba(255,255,255,0.95);padding:6px 10px;border-radius:999px;font-weight:700;border:1px solid rgba(0,0,0,0.06)}
    .badge.sale{background:linear-gradient(90deg,#FFF0F6,#FFE6EF);color:var(--primary-dark);border:1px solid rgba(226,24,90,0.06)}
    .badge.pulse{animation:pulse 2s infinite}
    @keyframes pulse{0%{transform:scale(1)}50%{transform:scale(1.03)}100%{transform:scale(1)}}

    /* Floating whatsapp */
    .fab-whatsapp{position:fixed;right:18px;bottom:18px;background:var(--accent);color:#fff;border-radius:999px;padding:14px 16px;box-shadow:0 10px 30px rgba(37,211,102,0.12);z-index:1300;text-decoration:none}

    /* Modal */
    .modal{position:fixed;inset:0;background:rgba(2,6,23,0.6);display:flex;align-items:center;justify-content:center;padding:20px;visibility:hidden;opacity:0;transition:opacity var(--transition),visibility var(--transition)}
    .modal.open{visibility:visible;opacity:1}
    .modal-card{background:var(--card);width:100%;max-width:900px;border-radius:12px;overflow:hidden;display:grid;grid-template-columns:1fr 380px}
    @media(max-width:880px){.modal-card{grid-template-columns:1fr}}
    .modal-media{height:100%;min-height:320px}
    .modal-body{padding:18px}

    footer{background:#111;color:#ddd;padding:28px 20px;margin-top:30px}
    .footer-inner{max-width:var(--max-width);margin:0 auto;display:flex;flex-wrap:wrap;gap:18px;justify-content:space-between}
    .footer-inner p{margin:0}

    /* small helpers */
    .muted{color:var(--muted)}
    .sr-only{position:absolute;width:1px;height:1px;padding:0;margin:-1px;overflow:hidden;clip:rect(0,0,0,0);white-space:nowrap;border:0}

    /* tiny responsive niceties */
    @media(max-width:480px){
      .hero{grid-template-columns:1fr}
      .brand span{font-size:1rem}
      .hero-title{font-size:1.5rem}
    }
  </style>
</head>
<body>

  <!--
    DICAS DE CUSTOMIZAÇÃO RÁPIDA (edite aqui):
    - Trocar número WhatsApp: altere a constante `phoneNumber` no final do arquivo (script).
    - Trocar imagens/produtos: edite a array `products` no script; cada item tem: id, title, category, price, img, badge, desc.
    - Configurações adicionais: `enableFavorites` (salvar favoritos no localStorage), `defaultSort`.
    - Se preferir HTML estático ao invés de geração por JS, copie o template de card dentro da função `renderProductCard`.
  -->

  <header>
    <div class="nav">
      <div class="brand" aria-label="BellaFlor - Artur Nogueira">
        <i class="fas fa-seedling" aria-hidden="true"></i>
        <span>BellaFlor <small>Artur Nogueira</small></span>
      </div>

      <div class="nav-actions" role="navigation" aria-label="filtros e contato">
        <button class="chip" id="allFilter" aria-pressed="true" tabindex="0">Todos</button>
        <button class="chip" data-category="Romântico" tabindex="0">Romântico</button>
        <button class="chip" data-category="Decoração" tabindex="0">Decoração</button>
        <button class="chip" data-category="Cestas" tabindex="0">Cestas</button>
        <button class="chip" data-category="Homenagem" tabindex="0">Homenagem</button>

        <a class="btn-whatsapp" id="headerWa" href="#" target="_blank" aria-label="Contactar pelo WhatsApp"><i class="fab fa-whatsapp" aria-hidden="true"></i> (19) 99802-8205</a>
      </div>
    </div>
  </header>

  <main>
    <section class="hero" aria-labelledby="heroTitle">
      <div class="hero-card">
        <h1 id="heroTitle" class="hero-title">Flores que Encantam — Entrega Rápida</h1>
        <p class="hero-sub">Arranjos frescos, buquês personalizados e cestas para todas as ocasiões. Encomende via WhatsApp com atendimento humano.</p>

        <div style="margin-top:14px" class="controls" role="search">
          <div class="search" aria-hidden="false">
            <i class="fas fa-search" style="color:var(--muted)" aria-hidden="true"></i>
            <input id="searchInput" placeholder="Buscar por buquê, flor ou ocasião..." aria-label="Pesquisar produtos" />
          </div>
          <select id="sortSelect" class="chip" style="padding:8px 12px;" aria-label="Ordenar produtos">
            <option value="default">Ordenar: Destaques</option>
            <option value="price_asc">Menor preço</option>
            <option value="price_desc">Maior preço</option>
            <option value="name_az">A → Z</option>
          </select>
        </div>

        <div class="features" style="margin-top:18px">
          <div class="feature"><i class="fas fa-truck" aria-hidden="true"></i><div><strong>Entrega em Artur Nogueira</strong><div class="muted">Mesmo dia (em horários selecionados)</div></div></div>
          <div class="feature"><i class="fas fa-hand-holding-heart" aria-hidden="true"></i><div><strong>Feito à mão</strong><div class="muted">Floristas experientes</div></div></div>
          <div class="feature"><i class="fas fa-award" aria-hidden="true"></i><div><strong>Qualidade Premium</strong><div class="muted">Flores selecionadas diariamente</div></div></div>
        </div>

      </div>

      <aside style="display:flex;flex-direction:column;gap:12px" aria-label="promoções e destaque">
        <div style="background:linear-gradient(135deg,var(--primary),var(--primary-dark));color:#fff;padding:18px;border-radius:12px;box-shadow:var(--shadow-md)">
          <div style="font-weight:800;font-size:1.05rem">Promoção de Natal</div>
          <div style="margin-top:6px;font-size:13px;">Descontos especiais em buquês selecionados. Peça pelo WhatsApp e feche em minutos.</div>
        </div>

        <div style="background:var(--card);padding:18px;border-radius:12px;box-shadow:var(--shadow-sm);display:flex;gap:12px;align-items:center">
          <img src="https://images.unsplash.com/photo-1545239351-1141bd82e8a6?ixlib=rb-4.0.3&auto=format&fit=crop&w=400&q=60" alt="loja" style="width:68px;height:68px;border-radius:10px;object-fit:cover">
          <div>
            <div style="font-weight:800">Atendimento via WhatsApp</div>
            <div class="muted" style="font-size:13px">Envie suas dúvidas e finalize a compra rapidamente.</div>
          </div>
        </div>
      </aside>
    </section>

    <section class="products-wrap" aria-labelledby="productsLabel">
      <div class="controls-row">
        <div><strong id="resultsCount">20</strong> produtos encontrados</div>
        <div class="muted">Filtre por categoria ou busque pelo nome</div>
      </div>

      <div id="grid" class="grid" aria-live="polite" aria-label="lista de produtos"></div>

    </section>

    <!-- Modal quick view -->
    <div id="modal" class="modal" role="dialog" aria-modal="true" aria-hidden="true">
      <div class="modal-card" role="document">
        <div class="modal-media" id="modalMedia"></div>
        <div class="modal-body">
          <h3 id="modalTitle"></h3>
          <p id="modalCategory" class="muted"></p>
          <p id="modalDesc"></p>
          <div style="display:flex;gap:10px;margin-top:18px;align-items:center">
            <div style="font-size:20px;font-weight:800;color:var(--primary-dark)" id="modalPrice"></div>
            <div style="margin-left:auto;display:flex;gap:8px">
              <button id="modalBuy" class="btn-primary btn-small">Comprar no WhatsApp</button>
              <button id="modalClose" class="btn-outline btn-small">Fechar</button>
            </div>
          </div>
        </div>
      </div>
    </div>

  </main>

  <a id="floatingWa" class="fab-whatsapp" href="#" target="_blank" aria-label="Abrir WhatsApp"><i class="fab fa-whatsapp" aria-hidden="true"></i></a>

  <footer>
    <div class="footer-inner">
      <div>
        <div style="font-weight:700;font-size:18px">BellaFlor Artur Nogueira</div>
        <p class="muted" style="max-width:360px">Transformando sentimentos em belos arranjos florais. Atendimento humano e entrega na região.</p>
      </div>
      <div style="min-width:220px">
        <div style="font-weight:700">Contato</div>
        <p class="muted">(19) 99802-8205</p>
        <p class="muted">Artur Nogueira, SP</p>
      </div>
      <div style="min-width:220px;display:flex;flex-direction:column;gap:8px">
        <div style="font-weight:700">Redes</div>
        <div style="display:flex;gap:8px"><a href="#" class="muted"><i class="fab fa-instagram" aria-hidden="true"></i> Instagram</a> <a href="#" class="muted"><i class="fab fa-facebook-f" aria-hidden="true"></i> Facebook</a></div>
      </div>
    </div>
    <div style="text-align:center;margin-top:18px;color:#888">&copy; 2025 BellaFlor Artur Nogueira. Todos os direitos reservados.</div>
  </footer>

  <script>
    /* ====== CONFIGURATION ====== */
    // Altere apenas estas variáveis para customizar:
    const phoneNumber = '5519998028205'; // 55 + DDD + número (apenas dígitos)
    const enableFavorites = true; // salvar favoritos no localStorage
    const defaultSort = 'default';

    /* ====== PRODUCTS (20 itens mínimo) ====== */
    const products = [
      {id:1,title:'Buquê de Rosas Vermelhas - 12 unidades',category:'Romântico',price:'R$ 139,90',img:'https://images.unsplash.com/photo-1599739291060-4578e77dac5d?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80',badge:'Mais Vendido',desc:'Rosas frescas selecionadas, embalagem premium.'},
      {id:2,title:'Arranjo Primavera',category:'Decoração',price:'R$ 129,90',img:'https://images.unsplash.com/photo-1563241527-3004b7be025f?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80',desc:'Mix vibrante de flores da estação em vaso de vidro.'},
      {id:3,title:'Cesta Flores do Campo',category:'Cestas',price:'R$ 169,90',img:'https://images.unsplash.com/photo-1525253641770-96dc4d732808?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80',badge:'Presente Ideal',desc:'Girassóis, gérberas e margaridas em cesta rústica.'},
      {id:4,title:'Coroa Saudade',category:'Homenagem',price:'R$ 239,00',img:'https://images.unsplash.com/photo-1596236569766-41e98d1a6032?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80',desc:'Coroa solene com opção de faixa personalizada.'},
      {id:5,title:'Buquê Mix Rosas e Lisianthus',category:'Romântico',price:'R$ 149,90',img:'https://images.unsplash.com/photo-1501004318641-b39e6451bec6?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80',desc:'Combinação romântica com lisianthus delicados.'},
      {id:6,title:'Arranjo Tropical',category:'Decoração',price:'R$ 119,90',img:'https://images.unsplash.com/photo-1504198453319-5ce911bafcde?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80',desc:'Folhagens exóticas e flores tropicais.'},
      {id:7,title:'Mini Suculentas (3un)',category:'Decoração',price:'R$ 69,90',img:'https://images.unsplash.com/photo-1587300003388-59208cc962cb?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80',desc:'Suculentas em vasinhos — presente simples e elegante.'},
      {id:8,title:'Buquê Girassóis',category:'Romântico',price:'R$ 119,90',img:'https://images.unsplash.com/photo-1501004318641-1a71e4b9b7bc?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80',desc:'Girassóis alegres e ensolarados.'},
      {id:9,title:'Cesta Gourmet + Flores',category:'Cestas',price:'R$ 249,90',img:'https://images.unsplash.com/photo-1544025162-d76694265947?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80',badge:'Oferta',desc:'Cesta com petiscos finos e arranjo compacto.'},
      {id:10,title:'Arranjo de Mesa Elegance',category:'Decoração',price:'R$ 139,90',img:'https://images.unsplash.com/photo-1477332552946-cfb384aeaf1c?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80',desc:'Perfeito para centro de mesa em eventos.'},
      {id:11,title:'Buquê Rosas Brancas',category:'Romântico',price:'R$ 129,90',img:'https://images.unsplash.com/photo-1514498145516-0a1bb2b3f0b9?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80',desc:'Rosas brancas para momentos puros e elegantes.'},
      {id:12,title:'Arranjo Natalino',category:'Decoração',price:'R$ 159,90',img:'https://images.unsplash.com/photo-1604335399101-5e0ef6f9b24a?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80',badge:'Sazonal',desc:'Composição com toques natalinos.'},
      {id:13,title:'Cesta Romântica',category:'Cestas',price:'R$ 199,90',img:'https://images.unsplash.com/photo-1506084868230-bb9d95c24759?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80',desc:'Cesta com vinho e buquê compacto.'},
      {id:14,title:'Arranjo Funerário Simples',category:'Homenagem',price:'R$ 179,00',img:'https://images.unsplash.com/photo-1508385082359-fb3a3c15a9aa?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80',desc:'Discreto e elegante para homenagens.'},
      {id:15,title:'Buquê Premium (24 Rosas)',category:'Romântico',price:'R$ 299,90',img:'https://images.unsplash.com/photo-1505765051481-3d2a3f5d1d25?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80',badge:'Premium',desc:'Buquê luxuoso com 24 rosas selecionadas.'},
      {id:16,title:'Arranjo Corporativo',category:'Decoração',price:'R$ 219,90',img:'https://images.unsplash.com/photo-1604437052400-9a6a6a1f0aaf?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80',desc:'Composições para empresas e eventos institucionais.'},
      {id:17,title:'Kit Maternidade',category:'Cestas',price:'R$ 179,90',img:'https://images.unsplash.com/photo-1545235617-7c3b840b1d7d?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80',desc:'Cesta com flores delicadas e presentinhos para a mãe.'},
      {id:18,title:'Orquídea em Vaso',category:'Decoração',price:'R$ 129,90',img:'https://images.unsplash.com/photo-1524594154906-1a0f95bb8d05?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80',desc:'Orquídea phalaenopsis em vaso cerâmico.'},
      {id:19,title:'Mini Buquê Diário',category:'Romântico',price:'R$ 59,90',img:'https://images.unsplash.com/photo-1464965911861-746a04b4bca3?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80',desc:'Pequeno buquê pronto para surpreender.'},
      {id:20,title:'Assinatura Mensal (Flores)',category:'Decoração',price:'R$ 99,90/mês',img:'https://images.unsplash.com/photo-1523731407965-2430cd12f5e4?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80',badge:'Assinatura',desc:'Receba flores frescas todo mês.'}
    ];

    /* ====== DOM REFERENCES ====== */
    const grid = document.getElementById('grid');
    const searchInput = document.getElementById('searchInput');
    const sortSelect = document.getElementById('sortSelect');
    const resultsCount = document.getElementById('resultsCount');
    const modal = document.getElementById('modal');
    const modalTitle = document.getElementById('modalTitle');
    const modalDesc = document.getElementById('modalDesc');
    const modalCategory = document.getElementById('modalCategory');
    const modalPrice = document.getElementById('modalPrice');
    const modalMedia = document.getElementById('modalMedia');
    const modalBuy = document.getElementById('modalBuy');
    const modalClose = document.getElementById('modalClose');
    const headerWa = document.getElementById('headerWa');
    const floatingWa = document.getElementById('floatingWa');

    /* ====== UTILIDADES ====== */
    function escapeHtml(s){return String(s).replace(/[&<>"']/g, c=>({"&":"&amp;","<":"&lt;",">":"&gt;","\"":"&quot;","'":"&#39;"}[c]));}

    // Converte strings de preço como "R$ 99,90" ou "R$ 99,90/mês" em número 99.9
    function parsePriceToNumber(priceStr){
      if(!priceStr) return 0;
      // remove tudo que não seja dígito, vírgula ou ponto
      let s = priceStr.replace(/[^0-9,\.]/g,'').trim();
      // Se existir ambas '.' e ',' assumimos que '.' é separador de milhares -> remover '.'
      if(s.indexOf('.') !== -1 && s.indexOf(',') !== -1){ s = s.replace(/\./g,''); }
      // trocar vírgula por ponto
      s = s.replace(/,/g,'.');
      const n = parseFloat(s);
      return Number.isFinite(n) ? n : 0;
    }

    function formatBRL(n){
      return n.toLocaleString('pt-BR',{style:'currency',currency:'BRL'});
    }

    function waLinkFor(product,qty=1){
      const text = encodeURIComponent(`Olá, gostaria de encomendar: *${product.title}* — ${product.price}${qty>1?` (x${qty})`:''}.\nID: ${product.id}`);
      return `https://wa.me/${phoneNumber}?text=${text}`;
    }

    /* Render card HTML from product object (used when generating DOM). */
    function renderProductCard(p){
      const el = document.createElement('article');
      el.className = 'card';
      el.setAttribute('data-id',p.id);
      el.innerHTML = `
        <div class="media">
          ${p.badge?`<div class="badge ${p.badge.toLowerCase().includes('oferta')||p.badge.toLowerCase().includes('sazonal')? 'sale':''}">${escapeHtml(p.badge)}</div>`:''}
          <img loading="lazy" alt="${escapeHtml(p.title)}" src="${p.img}" />
        </div>
        <div class="card-body">
          <div class="category">${escapeHtml(p.category)}</div>
          <div class="title">${escapeHtml(p.title)}</div>
          <div class="desc">${escapeHtml(p.desc)}</div>
          <div class="meta">
            <div class="price">${escapeHtml(p.price)}</div>
            <div class="actions">
              <button class="btn-small btn-outline" data-action="quick" data-id="${p.id}" aria-label="Ver ${escapeHtml(p.title)}">Ver</button>
              <a class="btn-small btn-primary" href="${waLinkFor(p)}" target="_blank" rel="noopener">Comprar</a>
            </div>
          </div>
        </div>`;

      // Accessibility: make the card focusable and open quick view on Enter
      el.tabIndex = 0;
      el.addEventListener('keydown', (e)=>{ if(e.key === 'Enter'){ openModal(p); } });

      // Favorite button (small heart) if enabled
      if(enableFavorites){
        const fav = document.createElement('button');
        fav.className = 'chip';
        fav.style.position = 'absolute';
        fav.style.right = '12px';
        fav.style.top = '12px';
        fav.style.padding = '6px 8px';
        fav.style.borderRadius = '999px';
        fav.setAttribute('aria-label','Favoritar produto');
        fav.innerHTML = `<i class="fa-regular fa-heart"></i>`;
        fav.addEventListener('click',(ev)=>{ ev.stopPropagation(); toggleFavorite(p.id, fav); });
        el.querySelector('.media').appendChild(fav);
        // set initial state
        if(isFavorite(p.id)) fav.innerHTML = `<i class="fa-solid fa-heart"></i>`;
      }

      return el;
    }

    /* Modal behavior with small focus trap */
    let lastFocused = null;
    function openModal(product){
      lastFocused = document.activeElement;
      modal.classList.add('open');
      modal.setAttribute('aria-hidden','false');
      modalTitle.textContent = product.title;
      modalDesc.textContent = product.desc;
      modalCategory.textContent = product.category;
      modalPrice.textContent = product.price;
      modalMedia.innerHTML = `<img src="${product.img}" alt="${product.title}" style="width:100%;height:100%;object-fit:cover">`;
      modalBuy.onclick = ()=> window.open(waLinkFor(product), '_blank');
      // focus trap simple
      modal.querySelector('#modalClose').focus();
      document.body.style.overflow = 'hidden';
    }

    function closeModal(){
      modal.classList.remove('open');
      modal.setAttribute('aria-hidden','true');
      document.body.style.overflow = '';
      if(lastFocused) lastFocused.focus();
    }

    modalClose.addEventListener('click', closeModal);
    modal.addEventListener('click', (e)=>{ if(e.target === modal) closeModal();});

    /* Favorites */
    function favoriteKey(){ return 'bellaflor_favs_v1'; }
    function favoritesList(){ try{ return JSON.parse(localStorage.getItem(favoriteKey())||'[]'); }catch(e){return []} }
    function isFavorite(id){ return favoritesList().includes(id); }
    function toggleFavorite(id, btn){
      const list = favoritesList();
      const idx = list.indexOf(id);
      if(idx === -1){ list.push(id); btn.innerHTML = `<i class="fa-solid fa-heart"></i>`; }
      else { list.splice(idx,1); btn.innerHTML = `<i class="fa-regular fa-heart"></i>`; }
      localStorage.setItem(favoriteKey(), JSON.stringify(list));
    }

    /* Filter / search / sort */
    function applyFilters(){
      const q = searchInput.value.trim().toLowerCase();
      const categoryActive = document.querySelector('.chip.active');
      let filtered = [...products];
      if(categoryActive && categoryActive.dataset.category){
        filtered = filtered.filter(p => p.category === categoryActive.dataset.category);
      }
      if(q) filtered = filtered.filter(p => (p.title + ' ' + p.desc + ' ' + p.category).toLowerCase().includes(q));

      // Sorting
      const sort = sortSelect.value || defaultSort;
      if(sort === 'price_asc') filtered.sort((a,b)=>parsePriceToNumber(a.price) - parsePriceToNumber(b.price));
      if(sort === 'price_desc') filtered.sort((a,b)=>parsePriceToNumber(b.price) - parsePriceToNumber(a.price));
      if(sort === 'name_az') filtered.sort((a,b)=>a.title.localeCompare(b.title,'pt-BR'));

      renderGrid(filtered);
    }

    function renderGrid(list){
      grid.innerHTML = '';
      if(!list.length){ grid.innerHTML = '<div class="muted">Nenhum produto encontrado. Tente outra busca ou remova filtros.</div>'; resultsCount.textContent = 0; return; }
      resultsCount.textContent = list.length;
      const fragment = document.createDocumentFragment();
      list.forEach(p => fragment.appendChild(renderProductCard(p)));
      grid.appendChild(fragment);
    }

    // Chips behaviour (keyboard + mouse)
    document.querySelectorAll('.chip').forEach(ch => {
      ch.addEventListener('click', ()=>{
        document.querySelectorAll('.chip').forEach(c=>c.classList.remove('active'));
        ch.classList.add('active');
        // special "Todos"
        if(ch.id === 'allFilter'){
          document.querySelectorAll('.chip').forEach(c=>c.classList.remove('active'));
          document.getElementById('allFilter').classList.add('active');
        }
        applyFilters();
      });
      ch.addEventListener('keydown',(e)=>{ if(e.key === 'Enter') ch.click(); });
    });

    // Delegate quick view
    grid.addEventListener('click', (e)=>{
      const btn = e.target.closest('[data-action]');
      if(!btn) return;
      const id = Number(btn.dataset.id);
      const product = products.find(p=>p.id===id);
      if(btn.dataset.action === 'quick') openModal(product);
    });

    // Wire search + sort
    searchInput.addEventListener('input', debounce(applyFilters,250));
    sortSelect.addEventListener('change', applyFilters);

    // set wa links
    headerWa.href = `https://wa.me/${phoneNumber}`;
    floatingWa.href = `https://wa.me/${phoneNumber}`;

    // initial render
    renderGrid(products);

    // small debounce util
    function debounce(fn,ms=200){let t;return(...args)=>{clearTimeout(t);t=setTimeout(()=>fn(...args),ms)}}

    // Accessibility: close modal with esc
    document.addEventListener('keydown', (e)=>{ if(e.key === 'Escape') closeModal(); });

    // Progressive enhancement: make chips "Todos" active by default
    document.getElementById('allFilter').classList.add('active');

    // Expose some helpers to console for quick editing
    window.BellaFlor = { products, applyFilters, renderGrid, parsePriceToNumber };
  </script>

</body>
</html>
