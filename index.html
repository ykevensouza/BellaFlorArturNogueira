<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BellaFlor | Sua Floricultura em Artur Nogueira</title>
    <!-- Meta tags b√°sicas de SEO -->
    <meta name="description" content="BellaFlor - Flores e arranjos florais em Artur Nogueira. Cat√°logo completo, compra f√°cil via PIX, Cart√£o e WhatsApp.">
    <meta name="keywords" content="Floricultura, Artur Nogueira, Flores, Buqu√™s, Arranjos, Rosas, Girass√≥is, Orqu√≠deas">

    <!-- Tailwind CSS CDN para estiliza√ß√£o r√°pida e responsiva -->
    <script src="https://cdn.tailwindcss.com"></script>

    <style>
        /* Paleta de cores e fontes personalizadas */
        :root {
            --color-primary: #D34C7C; /* Rosa Floral Profundo */
            --color-secondary: #4CAF50; /* Verde Fresco */
            --color-text: #333333;
            --color-background: #FAF8F8; /* Branco Suave */
            --color-hover: #E91E63;
        }

        /* Configura√ß√£o de Fonte Inter (Tailwind Default) */
        html { scroll-behavior: smooth; }
        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--color-background);
            color: var(--color-text);
        }

        /* Estilos customizados para bot√µes e cards */
        .btn-whatsapp {
            background-color: var(--color-secondary);
            transition: background-color 0.3s, transform 0.2s;
        }
        .btn-whatsapp:hover {
            background-color: #388E3C;
            transform: translateY(-2px);
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        .btn-buy {
            background-color: var(--color-primary);
            transition: background-color 0.3s, transform 0.2s;
        }
        .btn-buy:hover {
            background-color: var(--color-hover);
            transform: translateY(-2px);
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        .product-card {
            transition: transform 0.3s, box-shadow 0.3s;
        }
        .product-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.1);
        }

        /* Responsividade do Grid de Produtos */
        .product-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 24px;
        }

        /* Estilo para √≠cones SVG */
        .icon-svg {
            display: inline-block;
            width: 1.25em;
            height: 1.25em;
            fill: none;
            stroke: currentColor;
            stroke-width: 2;
            stroke-linecap: round;
            stroke-linejoin: round;
        }

        /* Estilos do Modal */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s, visibility 0.3s;
        }
        .modal-overlay.open {
            opacity: 1;
            visibility: visible;
        }
        .modal-content {
            background: white;
            padding: 30px;
            border-radius: 12px;
            max-width: 90%;
            width: 500px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
            transform: scale(0.9);
            transition: transform 0.3s ease-out;
        }
        .modal-overlay.open .modal-content {
            transform: scale(1);
        }

        /* Estilos do Alerta Customizado */
        #custom-alert {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 1100;
            padding: 15px 25px;
            border-radius: 8px;
            color: white;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            opacity: 0;
            transform: translateY(-20px);
            transition: opacity 0.3s, transform 0.3s;
        }
        #custom-alert.show {
            opacity: 1;
            transform: translateY(0);
        }
        #custom-alert.success { background-color: #4CAF50; }
        #custom-alert.error { background-color: #F44336; }
    </style>
</head>
<body>

    <!-- Alerta Customizado (Substitui alert()) -->
    <div id="custom-alert" class="hidden" role="alert"></div>

    <!-- HEADER (Navega√ß√£o Fixa) -->
    <header class="sticky top-0 z-50 bg-white shadow-md">
        <div class="container mx-auto px-4 py-4 flex justify-between items-center">
            <a href="#" class="text-3xl font-bold" style="color: var(--color-primary);">
                üå∏ Bella<span style="color: var(--color-secondary);">Flor</span>
            </a>
            <nav class="hidden md:flex space-x-6 text-lg font-medium">
                <a href="#hero" class="hover:text-gray-600 transition duration-150" style="color: var(--color-primary);">In√≠cio</a>
                <a href="#catalogo" class="hover:text-gray-600 transition duration-150" style="color: var(--color-primary);">Cat√°logo</a>
                <a href="#contato" class="hover:text-gray-600 transition duration-150" style="color: var(--color-primary);">Contato</a>
            </nav>
            <div class="flex items-center space-x-4">
                <!-- Campo de Busca -->
                <div class="relative hidden sm:block">
                    <input type="text" id="search-input" placeholder="Buscar flores..." class="py-2 pl-10 pr-4 border border-gray-300 rounded-full focus:ring-1" style="border-color: var(--color-primary); focus-ring: var(--color-primary);">
                    <svg class="icon-svg absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line></svg>
                </div>
                <!-- Bot√£o do Carrinho -->
                <button id="open-cart-btn" class="relative p-2 rounded-full hover:bg-gray-100 transition duration-150" aria-label="Carrinho de Compras" style="color: var(--color-primary);">
                    <svg class="icon-svg w-6 h-6" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M6 2L3 6v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V6l-3-4z"></path><line x1="3" y1="6" x2="21" y2="6"></line><path d="M16 10a4 4 0 0 1-8 0"></path></svg>
                    <span id="cart-count" class="absolute top-0 right-0 inline-flex items-center justify-center px-2 py-1 text-xs font-bold leading-none text-white transform translate-x-1/2 -translate-y-1/2 bg-red-600 rounded-full">0</span>
                </button>
                <!-- Menu Mobile (Hamburguer) -->
                <button id="menu-toggle-btn" class="md:hidden p-2 rounded-full hover:bg-gray-100 transition duration-150" aria-label="Menu" style="color: var(--color-primary);">
                    <svg class="icon-svg w-6 h-6" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line></svg>
                </button>
            </div>
        </div>
        <!-- Menu Mobile Dropdown -->
        <div id="mobile-menu" class="hidden md:hidden bg-white px-4 pb-4">
            <a href="#hero" class="block py-2 text-lg hover:bg-gray-50 rounded" style="color: var(--color-primary);">In√≠cio</a>
            <a href="#catalogo" class="block py-2 text-lg hover:bg-gray-50 rounded" style="color: var(--color-primary);">Cat√°logo</a>
            <a href="#contato" class="block py-2 text-lg hover:bg-gray-50 rounded" style="color: var(--color-primary);">Contato</a>
            <input type="text" id="search-input-mobile" placeholder="Buscar flores..." class="w-full mt-2 py-2 pl-4 pr-4 border border-gray-300 rounded-full focus:ring-1" style="border-color: var(--color-primary); focus-ring: var(--color-primary);">
        </div>
    </header>

    <main>
        <!-- HERO/BANNER -->
        <section id="hero" class="relative bg-gray-50 pt-20 pb-24" style="background-image: linear-gradient(135deg, #F9E7F1 0%, #E0F2F1 100%);">
            <div class="container mx-auto px-4 flex flex-col md:flex-row items-center justify-between">
                <div class="md:w-1/2 mb-10 md:mb-0 text-center md:text-left">
                    <h1 class="text-5xl md:text-6xl font-extrabold leading-tight mb-4" style="color: var(--color-primary);">
                        Flores Frescas. Emo√ß√µes Inesquec√≠veis.
                    </h1>
                    <p class="text-xl text-gray-700 mb-8">
                        Entrega r√°pida em Artur Nogueira. Encontre o arranjo perfeito para cada ocasi√£o.
                    </p>
                    <a href="#catalogo" class="btn-buy inline-block px-8 py-4 text-white font-semibold text-lg rounded-full shadow-lg hover:shadow-xl transition duration-300">
                        Ver Cat√°logo Agora
                    </a>
                </div>
                <div class="md:w-1/2 flex justify-center">
                    <!-- Imagem Placeholder para o Hero -->
                    <img src="https://placehold.co/500x350/F48FB1/FFFFFF?text=BellaFlor+em+Artur+Nogueira" alt="[Imagem de Buqu√™ de Flores vibrante]" class="rounded-2xl shadow-2xl object-cover w-full max-w-md">
                </div>
            </div>
        </section>

        <!-- CAT√ÅLOGO DE PRODUTOS -->
        <section id="catalogo" class="py-16 md:py-24">
            <div class="container mx-auto px-4">
                <h2 class="text-4xl font-bold text-center mb-12" style="color: var(--color-text);">Nosso Cat√°logo Floral</h2>

                <div id="products-grid" class="product-grid">
                    <!-- Produtos ser√£o injetados aqui pelo JavaScript -->
                    <div class="col-span-full text-center py-10" id="loading-message">Carregando o cat√°logo de flores...</div>
                </div>
                
                <div id="no-results-message" class="col-span-full text-center py-10 text-xl text-gray-500 hidden">Nenhum produto encontrado. Tente outra busca.</div>

            </div>
        </section>
    </main>

    <!-- FOOTER (Contatos e Informa√ß√µes) -->
    <footer id="contato" class="bg-gray-800 text-white mt-16">
        <div class="container mx-auto px-4 py-12">
            <div class="grid grid-cols-1 md:grid-cols-4 gap-8 border-b border-gray-700 pb-8 mb-8">
                <div>
                    <h3 class="text-2xl font-bold mb-4" style="color: var(--color-primary);">BellaFlor</h3>
                    <p class="text-gray-400">Sua floricultura de confian√ßa em Artur Nogueira. Levando a beleza da natureza at√© voc√™.</p>
                </div>
                <div>
                    <h4 class="text-xl font-semibold mb-4">Links R√°pidos</h4>
                    <ul class="space-y-2">
                        <li><a href="#hero" class="text-gray-400 hover:text-white transition duration-150">In√≠cio</a></li>
                        <li><a href="#catalogo" class="text-gray-400 hover:text-white transition duration-150">Cat√°logo</a></li>
                        <li><a href="#contato" class="text-gray-400 hover:text-white transition duration-150">Localiza√ß√£o</a></li>
                    </ul>
                </div>
                <div>
                    <h4 class="text-xl font-semibold mb-4">Contato</h4>
                    <p class="text-gray-400">
                        <svg class="icon-svg inline w-5 h-5 mr-2" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M22 16.92v3a2 2 0 0 1-2 2h-4a2 2 0 0 1-2-2v-3a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2zM12 16.92v3a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2v-3a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2zM22 3.92v3a2 2 0 0 1-2 2h-4a2 2 0 0 1-2-2v-3a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2zM12 3.92v3a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2v-3a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2z"></path></svg>
                        (19) 99802-8205 (WhatsApp)
                    </p>
                    <p class="text-gray-400 mt-2">
                        <svg class="icon-svg inline w-5 h-5 mr-2" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect><line x1="16" y1="2" x2="16" y2="6"></line><line x1="8" y1="2" x2="8" y2="6"></line><line x1="3" y1="10" x2="21" y2="10"></line></svg>
                        Seg-Sex: 9h - 18h
                    </p>
                    <p class="text-gray-400 mt-2">
                        S√°bado: 9h - 13h
                    </p>
                </div>
                <div>
                    <h4 class="text-xl font-semibold mb-4">Localiza√ß√£o</h4>
                    <p class="text-gray-400">Artur Nogueira, S√£o Paulo</p>
                    <p class="text-gray-400 mt-2">Atendemos toda a regi√£o com o frescor das flores.</p>
                </div>
            </div>
            <div class="text-center text-gray-500 text-sm">
                &copy; 2024 BellaFlor. Todos os direitos reservados.
            </div>
        </div>
    </footer>

    <!-- MODAL DE PAGAMENTO (escondido) -->
    <div id="payment-modal-overlay" class="modal-overlay">
        <div class="modal-content">
            <div class="flex justify-between items-center border-b pb-3 mb-4">
                <h3 class="text-2xl font-bold" style="color: var(--color-primary);">Finalizar Compra</h3>
                <button id="close-payment-modal-btn" class="text-gray-500 hover:text-gray-800">
                    <svg class="icon-svg w-6 h-6" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg>
                </button>
            </div>
            
            <div id="modal-product-info">
                <p class="text-lg font-semibold">Produto: <span id="modal-product-name" class="font-normal"></span></p>
                <p class="text-2xl font-bold mb-6" style="color: var(--color-secondary);">Pre√ßo: <span id="modal-product-price"></span></p>
            </div>

            <h4 class="text-xl font-semibold mb-4">Selecione o M√©todo de Pagamento:</h4>
            
            <div class="space-y-4">
                <button id="pay-pix" class="w-full text-center py-3 rounded-lg text-lg font-semibold text-white bg-blue-600 hover:bg-blue-700 transition duration-150">
                    PIX <span class="text-sm font-normal">(Recomendado)</span>
                </button>
                <button id="pay-card" class="w-full text-center py-3 rounded-lg text-lg font-semibold text-white bg-indigo-600 hover:bg-indigo-700 transition duration-150">
                    Cart√£o de Cr√©dito
                </button>
                <button id="pay-boleto" class="w-full text-center py-3 rounded-lg text-lg font-semibold text-gray-700 bg-yellow-400 hover:bg-yellow-500 transition duration-150">
                    Boleto Banc√°rio
                </button>
            </div>
        </div>
    </div>
    
    <!-- MODAL DO CARRINHO (escondido) -->
    <div id="cart-modal-overlay" class="modal-overlay">
        <div class="modal-content max-w-lg">
            <div class="flex justify-between items-center border-b pb-3 mb-4">
                <h3 class="text-2xl font-bold" style="color: var(--color-primary);">Seu Carrinho (Firestore)</h3>
                <button id="close-cart-modal-btn" class="text-gray-500 hover:text-gray-800">
                    <svg class="icon-svg w-6 h-6" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg>
                </button>
            </div>
            
            <div id="cart-items-list" class="space-y-4 max-h-80 overflow-y-auto pr-2">
                <!-- Itens do carrinho ser√£o injetados aqui -->
                <p id="empty-cart-message" class="text-center text-gray-500">Seu carrinho est√° vazio.</p>
            </div>
            
            <div class="mt-6 pt-4 border-t">
                <p class="text-xl font-bold flex justify-between">Total: <span id="cart-total" style="color: var(--color-primary);">R$ 0,00</span></p>
                <button id="checkout-all-btn" class="w-full btn-buy mt-4 px-4 py-3 text-white font-semibold rounded-lg disabled:opacity-50" disabled>
                    Finalizar Todos os Itens
                </button>
            </div>
            
            <div class="mt-4 text-xs text-gray-400 text-center">
                ID do Usu√°rio: <span id="current-user-id">Aguardando autentica√ß√£o...</span>
            </div>
        </div>
    </div>


    <!-- FIREBASE SETUP via CDN (MUST BE type="module") -->
    <script type="module">
        // Importa m√≥dulos necess√°rios do Firebase via CDN
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously, signInWithCustomToken, onAuthStateChanged, setLogLevel } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, doc, addDoc, setDoc, deleteDoc, onSnapshot, collection, query, updateDoc, increment } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        // Vari√°veis globais fornecidas pelo ambiente Canvas
        const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';
        const firebaseConfig = typeof __firebase_config !== 'undefined' ? JSON.parse(__firebase_config) : {};
        const initialAuthToken = typeof __initial_auth_token !== 'undefined' ? __initial_auth_token : null;

        let db = null;
        let auth = null;
        let userId = null;
        let isAuthReady = false;
        let cartItems = [];
        let unsubscribeCart = null; // Para desinscrever o listener do Firestore

        setLogLevel('debug'); // Ativa o log de debug do Firebase

        // --- DEFINI√á√ÉO DOS 30 PRODUTOS DA BELLAFOR ---
        const products = [
            { id: 1, name: "Buqu√™ de Rosas Vermelhas", desc: "Cl√°ssico da paix√£o. 12 rosas colombianas.", price: 149.90, img: "https://placehold.co/400x300/F48FB1/FFFFFF?text=Rosas+Vermelhas" },
            { id: 2, name: "Arranjo de Girass√≥is", desc: "Alegria e energia. 5 girass√≥is com folhagem.", price: 99.50, img: "https://placehold.co/400x300/FFC107/FFFFFF?text=Girass√≥is" },
            { id: 3, name: "Orqu√≠dea Phalaenopsis Branca", desc: "Eleg√¢ncia pura. Orqu√≠dea em vaso de cer√¢mica.", price: 199.90, img: "https://placehold.co/400x300/FFFFFF/333333?text=Orqu√≠dea+Branca" },
            { id: 4, name: "Cesta de Caf√© da Manh√£ Floral", desc: "Presente completo com flores e del√≠cias.", price: 179.00, img: "https://placehold.co/400x300/8BC34A/FFFFFF?text=Cesta+Floral" },
            { id: 5, name: "Rosa Encantada (A Bela e a Fera)", desc: "Rosa preservada em c√∫pula de vidro.", price: 250.00, img: "https://placehold.co/400x300/D34C7C/FFFFFF?text=Rosa+Encantada" },
            { id: 6, name: "L√≠rios Perfumados (Buqu√™)", desc: "Mix de l√≠rios brancos e rosas. Aroma incr√≠vel.", price: 110.00, img: "https://placehold.co/400x300/F06292/FFFFFF?text=Buqu√™+de+L√≠rios" },
            { id: 7, name: "Planta Suculenta Decorativa", desc: "Mini-jardim em pote de cimento.", price: 45.00, img: "https://placehold.co/400x300/795548/FFFFFF?text=Suculentas" },
            { id: 8, name: "Buqu√™ Colorido da Gratid√£o", desc: "Mix vibrante de flores do campo.", price: 85.90, img: "https://placehold.co/400x300/FF9800/FFFFFF?text=Buqu√™+Gratid√£o" },
            { id: 9, name: "Arranjo F√∫csia em Caixa", desc: "Rosas e astrom√©lias em tons de f√∫csia.", price: 135.00, img: "https://placehold.co/400x300/E91E63/FFFFFF?text=Arranjo+F√∫csia" },
            { id: 10, name: "Kalanchoe em Vaso", desc: "Flor da fortuna. V√°rias cores dispon√≠veis.", price: 35.00, img: "https://placehold.co/400x300/FF5722/FFFFFF?text=Kalanchoe" },
            { id: 11, name: "Buqu√™ de 6 Rosas Champanhe", desc: "Eleg√¢ncia e sofistica√ß√£o para celebrar.", price: 95.00, img: "https://placehold.co/400x300/FFE082/333333?text=Rosas+Champanhe" },
            { id: 12, name: "Coroa de Flores Naturais", desc: "Para ocasi√µes solenes. Entrega em 2h.", price: 299.00, img: "https://placehold.co/400x300/607D8B/FFFFFF?text=Coroa+de+Flores" },
            { id: 13, name: "Vaso de Violetas Africanas", desc: "Pequena e delicada. Perfeita para decorar.", price: 25.00, img: "https://placehold.co/400x300/9C27B0/FFFFFF?text=Violetas" },
            { id: 14, name: "Arranjo Tropical com Gengibre", desc: "Exotismo e cores fortes. Para ambientes modernos.", price: 155.00, img: "https://placehold.co/400x300/00BCD4/FFFFFF?text=Arranjo+Tropical" },
            { id: 15, name: "Buqu√™ de Alstroem√©rias Coloridas", desc: "Astrom√©lias em tons de arco-√≠ris.", price: 79.90, img: "https://placehold.co/400x300/FF4081/FFFFFF?text=Astrom√©lias" },
            { id: 16, name: "Mini Cactos Sortidos", desc: "Kit com 3 mini cactos em vasinhos decorados.", price: 60.00, img: "https://placehold.co/400x300/4CAF50/FFFFFF?text=Mini+Cactos" },
            { id: 17, name: "Orqu√≠dea Chuva de Ouro (Oncidium)", desc: "Cascata de pequenas flores amarelas.", price: 180.00, img: "https://placehold.co/400x300/FFEB3B/333333?text=Chuva+de+Ouro" },
            { id: 18, name: "Buqu√™ de Tulipas Roxas", desc: "S√≠mbolo de realeza. 10 tulipas frescas.", price: 165.00, img: "https://placehold.co/400x300/673AB7/FFFFFF?text=Tulipas+Roxas" },
            { id: 19, name: "Arranjo para Mesa de Jantar", desc: "Flores baixas e cheias de requinte.", price: 120.00, img: "https://placehold.co/400x300/9E9E9E/FFFFFF?text=Mesa+de+Jantar" },
            { id: 20, name: "Hort√™nsia Azul em Vaso", desc: "Flor cheia e vibrante. Vaso decorativo.", price: 140.00, img: "https://placehold.co/400x300/2196F3/FFFFFF?text=Hort√™nsia+Azul" },
            { id: 21, name: "Buqu√™ de Rosas Brancas", desc: "Paz e pureza. Ideal para casamentos e pedidos.", price: 130.00, img: "https://placehold.co/400x300/CFD8DC/333333?text=Rosas+Brancas" },
            { id: 22, name: "Mix de Flores do Campo", desc: "Charme r√∫stico em buqu√™ com 7 variedades.", price: 75.00, img: "https://placehold.co/400x300/CDDC39/333333?text=Flores+do+Campo" },
            { id: 23, name: "Planta Pata de Elefante", desc: "Decora√ß√£o moderna e dur√°vel em vaso alto.", price: 210.00, img: "https://placehold.co/400x300/A5D6A7/333333?text=Pata+de+Elefante" },
            { id: 24, name: "Buqu√™ de Margaridas Coloridas", desc: "Simplicidade e inoc√™ncia. Ideal para crian√ßas.", price: 65.00, img: "https://placehold.co/400x300/FFCDD2/333333?text=Margaridas" },
            { id: 25, name: "Arranjo para Maternidade (Urso)", desc: "Flores e ursinho de pel√∫cia.", price: 160.00, img: "https://placehold.co/400x300/F8BBD0/FFFFFF?text=Maternidade" },
            { id: 26, name: "Ant√∫rio Vermelho em Vaso", desc: "Durabilidade e cora√ß√£o vermelho intenso.", price: 89.00, img: "https://placehold.co/400x300/F44336/FFFFFF?text=Ant√∫rio+Vermelho" },
            { id: 27, name: "Buqu√™ Amarelo de Amizade", desc: "Flores amarelas diversas. Alegria garantida.", price: 105.00, img: "https://placehold.co/400x300/FFEB3B/333333?text=Buqu√™+Amarelo" },
            { id: 28, name: "Mini Rosa em Pote de Vidro", desc: "Lembrancinha charmosa. V√°rias cores.", price: 30.00, img: "https://placehold.co/400x300/FCE4EC/333333?text=Mini+Rosa" },
            { id: 29, name: "Bonsai de Carmona", desc: "Pequena √°rvore decorativa para interiores.", price: 190.00, img: "https://placehold.co/400x300/8D6E63/FFFFFF?text=Bonsai" },
            { id: 30, name: "Arranjo de G√©rberas Rosa", desc: "G√©rberas vibrantes em tons de rosa e pink.", price: 115.00, img: "https://placehold.co/400x300/FF80AB/FFFFFF?text=G√©rberas+Rosa" },
        ];


        // --- FUN√á√ïES UTILIT√ÅRIAS ---

        /**
         * Exibe um alerta customizado no canto superior direito.
         * @param {string} message - Mensagem a ser exibida.
         * @param {'success'|'error'} type - Tipo do alerta para cor (verde/vermelho).
         */
        function showCustomAlert(message, type = 'success') {
            const alertBox = document.getElementById('custom-alert');
            alertBox.textContent = message;
            alertBox.className = `show ${type}`; // Adiciona classes de exibi√ß√£o e tipo
            alertBox.style.display = 'block';

            setTimeout(() => {
                alertBox.className = 'hidden'; // Remove classes para ocultar
                alertBox.style.display = 'none';
            }, 3000); // 3 segundos
        }

        /**
         * Formata um n√∫mero para o padr√£o de moeda BRL.
         * @param {number} value
         * @returns {string}
         */
        function formatCurrency(value) {
            return value.toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' });
        }


        // --- FIREBASE / AUTH / FIRESTORE SETUP ---
        
        /**
         * Inicializa o Firebase e realiza a autentica√ß√£o.
         */
        async function initializeFirebase() {
            try {
                if (Object.keys(firebaseConfig).length === 0) {
                    console.error("Firebase Configura√ß√£o n√£o encontrada.");
                    showCustomAlert("Erro: Configura√ß√£o do Firebase ausente.", 'error');
                    isAuthReady = true;
                    return;
                }

                const app = initializeApp(firebaseConfig);
                db = getFirestore(app);
                auth = getAuth(app);

                // Autentica√ß√£o
                if (initialAuthToken) {
                    await signInWithCustomToken(auth, initialAuthToken);
                } else {
                    await signInAnonymously(auth);
                }
                
                // Listener de Estado de Autentica√ß√£o
                onAuthStateChanged(auth, (user) => {
                    if (user) {
                        userId = user.uid;
                        document.getElementById('current-user-id').textContent = userId;
                        console.log("Usu√°rio autenticado:", userId);
                        isAuthReady = true;
                        if (db) {
                            setupFirestoreListeners(userId);
                        }
                    } else {
                        userId = null;
                        document.getElementById('current-user-id').textContent = 'An√¥nimo (N√£o persistente)';
                        isAuthReady = true;
                        console.log("Usu√°rio deslogado/an√¥nimo.");
                    }
                });

            } catch (error) {
                console.error("Erro ao inicializar Firebase ou autenticar:", error);
                showCustomAlert("Erro de conex√£o com o servidor. Tente recarregar.", 'error');
                isAuthReady = true;
            }
        }

        /**
         * Configura o listener do Firestore para o carrinho de compras.
         * @param {string} currentUserId
         */
        function setupFirestoreListeners(currentUserId) {
            if (!db || !currentUserId) return;

            // Desinscreve o listener anterior, se houver
            if (unsubscribeCart) {
                unsubscribeCart();
            }

            // Path: /artifacts/{appId}/users/{userId}/cart_items
            const cartCollectionPath = `artifacts/${appId}/users/${currentUserId}/cart_items`;
            const cartQuery = collection(db, cartCollectionPath);

            unsubscribeCart = onSnapshot(cartQuery, (snapshot) => {
                cartItems = [];
                snapshot.forEach(doc => {
                    cartItems.push({ id: doc.id, ...doc.data() });
                });
                renderCart();
                console.log("Carrinho atualizado:", cartItems);
            }, (error) => {
                console.error("Erro ao carregar carrinho via onSnapshot:", error);
                showCustomAlert("Erro ao sincronizar carrinho.", 'error');
            });
        }


        // --- L√ìGICA DO CARRINHO (FIRESTORE) ---

        /**
         * Adiciona ou atualiza um produto no carrinho do Firestore.
         * @param {object} product - Produto a ser adicionado.
         */
        async function addToCart(product) {
            if (!isAuthReady || !userId || !db) {
                showCustomAlert("Aguarde a conex√£o com o servidor.", 'error');
                return;
            }

            const cartCollectionPath = `artifacts/${appId}/users/${userId}/cart_items`;
            const existingItem = cartItems.find(item => item.productId === product.id);

            try {
                if (existingItem) {
                    // Atualiza a quantidade do item existente
                    const itemDocRef = doc(db, cartCollectionPath, existingItem.id);
                    await updateDoc(itemDocRef, {
                        quantity: increment(1)
                    });
                } else {
                    // Adiciona um novo item
                    await addDoc(collection(db, cartCollectionPath), {
                        productId: product.id,
                        name: product.name,
                        price: product.price,
                        quantity: 1,
                        addedAt: new Date().toISOString()
                    });
                }
                showCustomAlert(`"${product.name}" adicionado ao carrinho!`, 'success');
            } catch (error) {
                console.error("Erro ao adicionar ao carrinho:", error);
                showCustomAlert("Falha ao adicionar produto ao carrinho. Tente novamente.", 'error');
            }
        }

        /**
         * Remove um produto do carrinho.
         * @param {string} docId - ID do documento no Firestore.
         */
        async function removeFromCart(docId) {
            if (!isAuthReady || !userId || !db) return;

            const cartCollectionPath = `artifacts/${appId}/users/${userId}/cart_items`;
            const itemDocRef = doc(db, cartCollectionPath, docId);
            
            try {
                await deleteDoc(itemDocRef);
                showCustomAlert("Item removido do carrinho.", 'success');
            } catch (error) {
                console.error("Erro ao remover do carrinho:", error);
                showCustomAlert("Falha ao remover item. Tente novamente.", 'error');
            }
        }

        /**
         * Renderiza o conte√∫do do carrinho no modal.
         */
        function renderCart() {
            const listContainer = document.getElementById('cart-items-list');
            const cartTotalElement = document.getElementById('cart-total');
            const emptyMessage = document.getElementById('empty-cart-message');
            const checkoutBtn = document.getElementById('checkout-all-btn');
            
            listContainer.innerHTML = '';
            let total = 0;

            if (cartItems.length === 0) {
                emptyMessage.style.display = 'block';
                checkoutBtn.disabled = true;
            } else {
                emptyMessage.style.display = 'none';
                checkoutBtn.disabled = false;
                
                cartItems.forEach(item => {
                    const productData = products.find(p => p.id === item.productId);
                    const itemPrice = (productData ? productData.price : item.price) * item.quantity;
                    total += itemPrice;

                    const itemElement = document.createElement('div');
                    itemElement.className = 'flex items-center justify-between p-3 bg-gray-50 rounded-lg';
                    itemElement.innerHTML = `
                        <div>
                            <p class="font-semibold">${item.name} (${item.quantity}x)</p>
                            <p class="text-sm text-gray-600">${formatCurrency(itemPrice)}</p>
                        </div>
                        <button data-doc-id="${item.id}" class="remove-from-cart-btn text-red-500 hover:text-red-700 transition duration-150">
                            <svg class="icon-svg w-5 h-5" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18"></path><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path><line x1="10" y1="11" x2="10" y2="17"></line><line x1="14" y1="11" x2="14" y2="17"></line></svg>
                        </button>
                    `;
                    listContainer.appendChild(itemElement);
                });
            }

            cartTotalElement.textContent = formatCurrency(total);
            document.getElementById('cart-count').textContent = cartItems.length;

            // Adiciona listeners aos bot√µes de remo√ß√£o
            listContainer.querySelectorAll('.remove-from-cart-btn').forEach(button => {
                button.addEventListener('click', (e) => {
                    const docId = e.currentTarget.getAttribute('data-doc-id');
                    removeFromCart(docId);
                });
            });
        }


        // --- L√ìGICA DE RENDERIZA√á√ÉO E UI ---

        /**
         * Renderiza a lista de produtos na p√°gina.
         * @param {Array} productList - Lista de produtos filtrada ou completa.
         */
        function renderProducts(productList) {
            const grid = document.getElementById('products-grid');
            const loading = document.getElementById('loading-message');
            const noResults = document.getElementById('no-results-message');
            
            loading.style.display = 'none';
            grid.innerHTML = '';

            if (productList.length === 0) {
                noResults.style.display = 'block';
                return;
            }
            noResults.style.display = 'none';


            productList.forEach(product => {
                const productCard = document.createElement('div');
                productCard.className = 'product-card bg-white rounded-xl shadow-lg overflow-hidden border border-gray-100 hover:border-gray-200';
                
                const priceFormatted = formatCurrency(product.price);
                const descTruncated = product.desc.length > 50 ? product.desc.substring(0, 47) + '...' : product.desc;

                productCard.innerHTML = `
                    <img src="${product.img}" alt="[Imagem de ${product.name}]" class="w-full h-48 object-cover">
                    <div class="p-5">
                        <h3 class="text-xl font-bold mb-2 h-14" style="color: var(--color-text);">${product.name}</h3>
                        <p class="text-sm text-gray-500 mb-3 h-10">${descTruncated}</p>
                        <p class="text-3xl font-extrabold mb-4" style="color: var(--color-primary);">${priceFormatted}</p>
                        
                        <div class="flex flex-col space-y-2">
                            <!-- Bot√£o WhatsApp -->
                            <a href="https://wa.me/5519998028205?text=Ol%C3%A1!%20Gostaria%20de%20informa%C3%A7%C3%B5es%20sobre%20${encodeURIComponent(product.name)}%20-%20${encodeURIComponent(priceFormatted)}" 
                                target="_blank" 
                                class="btn-whatsapp flex items-center justify-center px-4 py-2 text-white font-semibold rounded-lg shadow-md text-sm">
                                <svg class="icon-svg w-5 h-5 mr-2 fill-white" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M21 15c-1.4 1.7-2.9 2.5-4.5 2.5s-3.1-.8-4.5-2.5c-1.4 1.7-2.9 2.5-4.5 2.5S3.9 16.7 2.5 15a10 10 0 1 1 18.5 0z" fill="none"></path><path d="M12.25 10.75A.75.75 0 0 0 13 10c0-.4-.35-.75-.75-.75zm-1.5 0A.75.75 0 0 0 11 10c0-.4-.35-.75-.75-.75zm0 3.5A.75.75 0 0 0 11 14.25c0 .4-.35.75-.75.75zm1.5 0A.75.75 0 0 0 13 14.25c0 .4-.35.75-.75.75z"></path><path d="M12 2C6.48 2 2 6.48 2 12c0 1.5.35 2.9.96 4.17l-.76 2.76 2.76-.76C7.1 21.65 8.5 22 10 22h4c1.5 0 2.9-.35 4.17-.96l2.76.76-.76-2.76C21.65 19.9 22 18.5 22 17c0-5.52-4.48-10-10-10zM12 20c-1.37 0-2.7-.35-3.89-1l-.54-.2-1.93.53.53-1.93-.2-.54C4.35 14.7 4 13.37 4 12c0-4.41 3.59-8 8-8s8 3.59 8 8-3.59 8-8 8z" fill="none"></path></svg>
                                Falar no WhatsApp
                            </a>
                            
                            <!-- Bot√£o Comprar (Abre Modal de Pagamento) -->
                            <button data-product-id="${product.id}" 
                                class="btn-buy open-payment-modal flex items-center justify-center px-4 py-2 text-white font-semibold rounded-lg shadow-md text-sm">
                                <svg class="icon-svg w-5 h-5 mr-2" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><rect x="1" y="4" width="22" height="16" rx="2" ry="2"></rect><line x1="1" y1="10" x2="23" y2="10"></line></svg>
                                Comprar / Ver Op√ß√µes
                            </button>
                            
                            <!-- Bot√£o Adicionar ao Carrinho -->
                            <button data-product-id="${product.id}" 
                                class="add-to-cart-btn flex items-center justify-center px-4 py-2 text-gray-700 font-semibold rounded-lg border border-gray-300 hover:bg-gray-100 transition duration-150 text-sm">
                                <svg class="icon-svg w-5 h-5 mr-2" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M6 2L3 6v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V6l-3-4z"></path><line x1="3" y1="6" x2="21" y2="6"></line><path d="M16 10a4 4 0 0 1-8 0"></path></svg>
                                Adicionar ao Carrinho
                            </button>
                        </div>
                    </div>
                `;
                grid.appendChild(productCard);
            });
        }

        /**
         * Abre o modal de pagamento com as informa√ß√µes do produto.
         * @param {object} product - Produto selecionado.
         */
        function showPaymentModal(product) {
            document.getElementById('modal-product-name').textContent = product.name;
            document.getElementById('modal-product-price').textContent = formatCurrency(product.price);
            
            const modalOverlay = document.getElementById('payment-modal-overlay');
            modalOverlay.classList.add('open');
            modalOverlay.setAttribute('data-product-id', product.id);
        }

        /**
         * Fecha o modal de pagamento.
         */
        function closePaymentModal() {
            document.getElementById('payment-modal-overlay').classList.remove('open');
            document.getElementById('payment-modal-overlay').removeAttribute('data-product-id');
        }
        
        /**
         * Abre o modal do carrinho.
         */
        function openCartModal() {
            document.getElementById('cart-modal-overlay').classList.add('open');
        }
        
        /**
         * Fecha o modal do carrinho.
         */
        function closeCartModal() {
            document.getElementById('cart-modal-overlay').classList.remove('open');
        }


        /**
         * Simula o processo de pagamento e redirecionamento.
         * @param {string} method - M√©todo de pagamento ('pix', 'card', 'boleto').
         * @param {object} product - Produto a ser pago.
         */
        function processPayment(method, product) {
            closePaymentModal();
            const simulatedUrl = `https://simulacao-pagamento.com/${method}?prod=${product.id}&val=${product.price}`;
            
            // Simula√ß√£o de redirecionamento para gateway de pagamento
            console.log(`Simulando redirecionamento para ${method}: ${simulatedUrl}`);

            showCustomAlert(`‚úÖ Sucesso! Simula√ß√£o de pagamento via ${method.toUpperCase()} iniciada para ${product.name}. Redirecionando...`, 'success');

            // No mundo real, voc√™ usaria window.location.href = simulatedUrl aqui.
            // Para o escopo da tarefa, apenas a mensagem de sucesso √© suficiente.
        }

        /**
         * Configura todos os event listeners da p√°gina.
         */
        function setupListeners() {
            // 1. Cat√°logo (Bot√µes Comprar e Carrinho)
            document.getElementById('products-grid').addEventListener('click', (e) => {
                const productId = parseInt(e.target.closest('[data-product-id]')?.getAttribute('data-product-id'));
                if (!productId) return;

                const product = products.find(p => p.id === productId);
                if (!product) return;

                if (e.target.closest('.open-payment-modal')) {
                    showPaymentModal(product);
                } else if (e.target.closest('.add-to-cart-btn')) {
                    addToCart(product);
                }
            });

            // 2. Modais (Fechamento)
            document.getElementById('close-payment-modal-btn').addEventListener('click', closePaymentModal);
            document.getElementById('payment-modal-overlay').addEventListener('click', (e) => {
                if (e.target === e.currentTarget) closePaymentModal();
            });

            document.getElementById('close-cart-modal-btn').addEventListener('click', closeCartModal);
            document.getElementById('cart-modal-overlay').addEventListener('click', (e) => {
                if (e.target === e.currentTarget) closeCartModal();
            });

            // 3. Modal (Op√ß√µes de Pagamento)
            document.getElementById('payment-modal-overlay').addEventListener('click', (e) => {
                const modalOverlay = document.getElementById('payment-modal-overlay');
                const productId = parseInt(modalOverlay.getAttribute('data-product-id'));
                const product = products.find(p => p.id === productId);
                if (!product) return;

                if (e.target.id === 'pay-pix') {
                    processPayment('pix', product);
                } else if (e.target.id === 'pay-card') {
                    processPayment('card', product);
                } else if (e.target.id === 'pay-boleto') {
                    processPayment('boleto', product);
                }
            });
            
            // 4. Carrinho (Abertura e Checkout)
            document.getElementById('open-cart-btn').addEventListener('click', openCartModal);
            document.getElementById('checkout-all-btn').addEventListener('click', () => {
                if (cartItems.length > 0) {
                    closeCartModal();
                    // Simula checkout de todos os itens do carrinho (idealmente processaria a compra via PIX/Card)
                    showCustomAlert(`Simula√ß√£o de Checkout de ${cartItems.length} itens do carrinho.`, 'success');
                    // Aqui seria a l√≥gica para limpar o carrinho no Firestore, mas vamos apenas simular.
                    console.log("Simula√ß√£o: Checkout de todos os itens do carrinho. O carrinho permance para demonstra√ß√£o.");
                } else {
                    showCustomAlert("Carrinho vazio!", 'error');
                }
            });

            // 5. Busca/Filtro
            const searchInputDesktop = document.getElementById('search-input');
            const searchInputMobile = document.getElementById('search-input-mobile');
            
            const handleSearch = (event) => {
                const query = event.target.value.toLowerCase();
                const filteredProducts = products.filter(p => 
                    p.name.toLowerCase().includes(query) || 
                    p.desc.toLowerCase().includes(query)
                );
                renderProducts(filteredProducts);
            };

            searchInputDesktop.addEventListener('keyup', handleSearch);
            searchInputMobile.addEventListener('keyup', handleSearch);
            
            // 6. Menu Mobile
            document.getElementById('menu-toggle-btn').addEventListener('click', () => {
                document.getElementById('mobile-menu').classList.toggle('hidden');
            });
        }


        // --- INICIALIZA√á√ÉO GERAL ---

        window.onload = function() {
            // 1. Renderiza o cat√°logo inicial
            renderProducts(products);
            
            // 2. Configura os listeners de intera√ß√£o
            setupListeners();
            
            // 3. Inicializa Firebase (Autentica√ß√£o e Listener do Carrinho)
            initializeFirebase();
        };

    </script>

</body>
</html>